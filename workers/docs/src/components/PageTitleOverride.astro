---
import type { Props } from "@astrojs/starlight/props";
import Default from "@astrojs/starlight/components/PageTitle.astro";
import PageActions from "./PageActions";
---

<div class="page-title-override">
  <div class="page-title-content">
    <Default {...Astro.props}><slot /></Default>
  </div>
  <div class="page-title-actions">
    <PageActions client:load />
  </div>
</div>

<style>
  .page-title-override {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 2rem;
    position: relative;
  }

  .page-title-content {
    flex: 1;
  }

  @media (max-width: 50rem) {
    .page-title-override {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
  }
</style>

<script is:inline>
  // Ensure all external links (like GitHub in social nav) open in a new tab
  document.addEventListener('DOMContentLoaded', () => {
    const handleExternalLinks = () => {
      const links = document.querySelectorAll('a[href^="http"]');
      links.forEach(link => {
        const url = new URL(link.href);
        if (url.origin !== window.location.origin) {
          link.setAttribute('target', '_blank');
          link.setAttribute('rel', 'noopener noreferrer');
        }
      });
    };

    handleExternalLinks();
    // Re-run if Starlight dynamic nav happens
    const observer = new MutationObserver(handleExternalLinks);
    observer.observe(document.body, { childList: true, subtree: true });
  });
</script>
